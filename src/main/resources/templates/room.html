<!DOCTYPE html>
<html xmlns:sec="" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>chat</title>
    <!-- Bootstrap core CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css">
</head>
<body>
<script th:inline="javascript">
    let webSocket;
    /* <![CDATA[*/
    let roomId = '/*[[${room.roomId}]]*/';
    /* ]]> */
    const userNm = document.getElementById('userName').innerHTML;
    connect();
    document.getElementById("send").addEventListener("click", function () {
        send();
    })


    var check = false;
    var numberChoice = 0;

    function sendNumber(number) {
        if (check === true) {
            webSocket.send(JSON.stringify({chatRoomId: roomId, type: 'GAME', writer: userNm, message: number}));
        } else {
            const chatroom = document.getElementById("chatroom");
            chatroom.innerHTML = chatroom.innerHTML + "<br>" + "숫자 버튼을 선택해주세요";

        }
    }

    function choiceNumber(number) {
        check = true;
        numberChoice = number;
    }


    function connect() {
        webSocket = new WebSocket("ws://localhost:8080/chat");
        webSocket.onopen = onOpen;
        webSocket.onclose = onClose;
        webSocket.onmessage = onMessage;
    }

    function disconnect() {
        webSocket.send(JSON.stringify({chatRoomId: roomId, type: 'LEAVE', writer: userNm}));
        webSocket.close();
    }

    function send() {
        const msg = document.getElementById("message").value;
        webSocket.send(JSON.stringify({chatRoomId: roomId, type: 'CHAT', writer: userNm, message: msg}));
        document.getElementById("message").value = "";
    }

    function onOpen() {
        webSocket.send(JSON.stringify({chatRoomId: roomId, type: 'ENTER', writer: userNm}));
    }

    function onMessage(e) {
        // const data = JSON.parse(e.data);
        console.log(e);

        /**
         *
         *

         switch(msg.type) {
            case "id":
              clientID = msg.id;
              setUsername();
              break;
            case "username":
              text = "<b>User <em>" + msg.name + "</em> signed in at " + timeStr + "</b><br>";
              break;
            case "message":
              text = "(" + timeStr + ") <b>" + msg.name + "</b>: " + msg.text + "<br>";
              break;
            case "rejectusername":
              text = "<b>Your username has been set to <em>" + msg.name + "</em> because the name you chose is in use.</b><br>"
              break;
            case "userlist":
              var ul = "";
              for (i=0; i < msg.users.length; i++) {
                ul += msg.users[i] + "<br>";
          }
          document.getElementById("userlistbox").innerHTML = ul;
          break;
        }

         if (text.length) {
    f.write(text);
    document.getElementById("chatbox").contentWindow.scrollByPages(1);
  }


         *

         const data = JSON.stringify(e.data);
         if (data.indexOf("GR^^")) {
            // var tempData = data.replace("GAME^^","")
            // chatroom.innerHTML = chatroom.innerHTML + "<br>" + tempData;

            document.getElementById("roomUserCount").value = "";

        } else {
            const chatroom = document.getElementById("chatroom");
            chatroom.innerHTML = chatroom.innerHTML + "<br>" + data;
        }
         */
    }

    function onClose() {
        disconnect();
    }

</script>

<span id="userName" sec:authentication="name"></span>님 게임시작합니다.
<label for="roomId" class="label label-default">방 번호</label>
<label th:text="*{room.roomId}" id="roomId" class="form-inline"></label>
<br>
<label for="roomName" class="label label-default">방 이름</label>
<label th:text="*{room.name}" id="roomName" class="form-inline"></label>
<br>
<label for="roomName" class="label label-default">방 인원 수</label>
<label th:text="*{room.roomUserCount}" id="roomUserCount" class="form-inline"></label>
<br>

<div>
    <table border="0" cellpadding="0" cellspacing="0" id="board" >
        <tr>
            <td><button class="btn btn-light" id="send1" onclick="sendNumber(1)">0</button></td>
            <td><button class="btn btn-light" id="send2" onclick="sendNumber(2)">0</button></td>
            <td><button class="btn btn-light" id="send3" onclick="sendNumber(3)">0</button></td>
            <td><button class="btn btn-light" id="send4" onclick="sendNumber(4)">0</button></td>
            <td><button class="btn btn-light" id="send5" onclick="sendNumber(5)">0</button></td>
            <td><button class="btn btn-light" id="send6" onclick="sendNumber(6)">0</button></td>
            <td><button class="btn btn-light" id="send7" onclick="sendNumber(7)">0</button></td>
        </tr>
        <tr>
            <td><button class="btn btn-light" id="send8" onclick="sendNumber(8)">0</button></td>
            <td><button class="btn btn-light" id="send9" onclick="sendNumber(9)">0</button></td>
            <td><button class="btn btn-light" id="send10" onclick="sendNumber(10)">0</button></td>
            <td><button class="btn btn-light" id="send11" onclick="sendNumber(11)">0</button></td>
            <td><button class="btn btn-light" id="send12" onclick="sendNumber(12)">0</button></td>
            <td><button class="btn btn-light" id="send13" onclick="sendNumber(13)">0</button></td>
            <td><button class="btn btn-light" id="send14" onclick="sendNumber(14)">0</button></td>
        </tr>
        <tr>
            <td><button class="btn btn-light" id="send15" onclick="sendNumber(15)">0</button></td>
            <td><button class="btn btn-light" id="send16" onclick="sendNumber(16)">0</button></td>
            <td><button class="btn btn-light" id="send17" onclick="sendNumber(17)">0</button></td>
            <td><button class="btn btn-light" id="send18" onclick="sendNumber(18)">0</button></td>
            <td><button class="btn btn-light" id="send19" onclick="sendNumber(19)">0</button></td>
            <td><button class="btn btn-light" id="send20" onclick="sendNumber(20)">0</button></td>
            <td><button class="btn btn-light" id="send21" onclick="sendNumber(21)">0</button></td>
        </tr>
        <tr>
            <td><button class="btn btn-light" id="send22" onclick="sendNumber(22)">0</button></td>
            <td><button class="btn btn-light" id="send23" onclick="sendNumber(23)">0</button></td>
            <td><button class="btn btn-light" id="send24" onclick="sendNumber(24)">0</button></td>
            <td><button class="btn btn-light" id="send25" onclick="sendNumber(25)">0</button></td>
            <td><button class="btn btn-light" id="send26" onclick="sendNumber(26)">0</button></td>
            <td><button class="btn btn-light" id="send27" onclick="sendNumber(27)">0</button></td>
            <td><button class="btn btn-light" id="send28" onclick="sendNumber(28)">0</button></td>
        </tr>
        <tr>
            <td><button class="btn btn-light" id="send29" onclick="sendNumber(29)">0</button></td>
            <td><button class="btn btn-light" id="send30" onclick="sendNumber(30)">0</button></td>
            <td><button class="btn btn-light" id="send31" onclick="sendNumber(31)">0</button></td>
            <td><button class="btn btn-light" id="send32" onclick="sendNumber(32)">0</button></td>
            <td><button class="btn btn-light" id="send33" onclick="sendNumber(33)">0</button></td>
            <td><button class="btn btn-light" id="send34" onclick="sendNumber(34)">0</button></td>
            <td><button class="btn btn-light" id="send35" onclick="sendNumber(35)">0</button></td>
        </tr>
        <tr>
            <td><button class="btn btn-light" id="send36" onclick="sendNumber(36)">0</button></td>
            <td><button class="btn btn-light" id="send37" onclick="sendNumber(37)">0</button></td>
            <td><button class="btn btn-light" id="send38" onclick="sendNumber(38)">0</button></td>
            <td><button class="btn btn-light" id="send39" onclick="sendNumber(39)">0</button></td>
            <td><button class="btn btn-light" id="send40" onclick="sendNumber(40)">0</button></td>
            <td><button class="btn btn-light" id="send41" onclick="sendNumber(41)">0</button></td>
            <td><button class="btn btn-light" id="send42" onclick="sendNumber(42)">0</button></td>
        </tr>
        <tr>
            <td><button class="btn btn-light" id="send43" onclick="sendNumber(43)">0</button></td>
            <td><button class="btn btn-light" id="send44" onclick="sendNumber(44)">0</button></td>
            <td><button class="btn btn-light" id="send45" onclick="sendNumber(45)">0</button></td>
            <td><button class="btn btn-light" id="send46" onclick="sendNumber(46)">0</button></td>
            <td><button class="btn btn-light" id="send47" onclick="sendNumber(47)">0</button></td>
            <td><button class="btn btn-light" id="send48" onclick="sendNumber(48)">0</button></td>
            <td><button class="btn btn-light" id="send49" onclick="sendNumber(49)">0</button></td>
        </tr>
    </table>
</div>

<br/><br/>

<table border="0" cellpadding="0" cellspacing="0" id="board2"  >
    <tr>
        <td><button type="button" class="btn btn-primary" onclick="choiceNumber(1)">1</button></td>
        <td><button type="button" class="btn btn-secondary" onclick="choiceNumber(2)">2</button></td>
        <td><button type="button" class="btn btn-success" onclick="choiceNumber(3)">3</button></td>
        <td><button type="button" class="btn btn-danger" onclick="choiceNumber(4)">4</button></td>
        <td><button type="button" class="btn btn-warning" onclick="choiceNumber(5)">5</button></td>
        <td><button type="button" class="btn btn-info" onclick="choiceNumber(6)">6</button></td>
        <td><button type="button" class="btn btn-dark" onclick="choiceNumber(7)">7</button></td>
    <tr align="center" >
        <td id="one">3</td>
        <td id="two">3</td>
        <td id="three">3</td>
        <td id="four">3</td>
        <td id="five">3</td>
        <td id="six">3</td>
        <td id="seven">2</td>
    </tr>
</table>


<div id="chatroom" style="width:400px; height: 600px; border:1px solid; background-color : gray"></div>
<input type="text" id="message" style="height : 30px; width : 340px" placeholder="내용을 입력하세요" autofocus>
<button class="btn btn-primary" id="send">전송</button>

<div id="chatGame" style="width:400px; border:1px solid; background-color : gray"></div>





</body>
</html>