<!DOCTYPE html>
<html xmlns:sec="" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>chat</title>
    <!-- Bootstrap core CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css">
</head>
<body>

<span id="userName" sec:authentication="name"></span>님 게임시작합니다.
<label for="roomId" class="label label-default">방 번호</label>
<label th:text="*{room.roomId}" id="roomId" class="form-inline"></label>
<br>
<label for="roomName" class="label label-default">방 이름</label>
<label th:text="*{room.name}" id="roomName" class="form-inline"></label>
<br>
<label for="roomName" class="label label-default">방 인원 수</label>
<label th:text="*{room.roomUserCount}" id="roomUserCount" class="form-inline"></label>
<br>

<div>
    <table border="0" cellpadding="0" cellspacing="0" id="board" >
        <tr>
            <td><button class="btn btn-light" id="send00" onclick="sendNumber('00')">&nbsp;&nbsp;</button></td>
            <td><button class="btn btn-light" id="send01" onclick="sendNumber('01')">&nbsp;&nbsp;</button></td>
            <td><button class="btn btn-light" id="send02" onclick="sendNumber('02')">&nbsp;&nbsp;</button></td>
            <td><button class="btn btn-light" id="send03" onclick="sendNumber('03')">&nbsp;&nbsp;</button></td>
            <td><button class="btn btn-light" id="send04" onclick="sendNumber('04')">&nbsp;&nbsp;</button></td>
            <td><button class="btn btn-light" id="send05" onclick="sendNumber('05')">&nbsp;&nbsp;</button></td>
            <td><button class="btn btn-light" id="send06" onclick="sendNumber('06')">&nbsp;&nbsp;</button></td>
        </tr>
        <tr>
            <td><button class="btn btn-light" id="send10" onclick="sendNumber('10')">&nbsp;&nbsp;</button></td>
            <td><button class="btn btn-light" id="send11" onclick="sendNumber('11')">&nbsp;&nbsp;</button></td>
            <td><button class="btn btn-light" id="send12" onclick="sendNumber('12')">&nbsp;&nbsp;</button></td>
            <td><button class="btn btn-light" id="send13" onclick="sendNumber('13')">&nbsp;&nbsp;</button></td>
            <td><button class="btn btn-light" id="send14" onclick="sendNumber('14')">&nbsp;&nbsp;</button></td>
            <td><button class="btn btn-light" id="send15" onclick="sendNumber('15')">&nbsp;&nbsp;</button></td>
            <td><button class="btn btn-light" id="send16" onclick="sendNumber('16')">&nbsp;&nbsp;</button></td>
        </tr>
        <tr>
            <td><button class="btn btn-light" id="send20" onclick="sendNumber('20')">&nbsp;&nbsp;</button></td>
            <td><button class="btn btn-light" id="send21" onclick="sendNumber('21')">&nbsp;&nbsp;</button></td>
            <td><button class="btn btn-light" id="send22" onclick="sendNumber('22')">&nbsp;&nbsp;</button></td>
            <td><button class="btn btn-light" id="send23" onclick="sendNumber('23')">&nbsp;&nbsp;</button></td>
            <td><button class="btn btn-light" id="send24" onclick="sendNumber('24')">&nbsp;&nbsp;</button></td>
            <td><button class="btn btn-light" id="send25" onclick="sendNumber('25')">&nbsp;&nbsp;</button></td>
            <td><button class="btn btn-light" id="send26" onclick="sendNumber('26')">&nbsp;&nbsp;</button></td>
        </tr>
        <tr>
            <td><button class="btn btn-light" id="send30" onclick="sendNumber('30')">&nbsp;&nbsp;</button></td>
            <td><button class="btn btn-light" id="send31" onclick="sendNumber('31')">&nbsp;&nbsp;</button></td>
            <td><button class="btn btn-light" id="send32" onclick="sendNumber('32')">&nbsp;&nbsp;</button></td>
            <td><button class="btn btn-light" id="send33" onclick="sendNumber('33')">&nbsp;&nbsp;</button></td>
            <td><button class="btn btn-light" id="send34" onclick="sendNumber('34')">&nbsp;&nbsp;</button></td>
            <td><button class="btn btn-light" id="send35" onclick="sendNumber('35')">&nbsp;&nbsp;</button></td>
            <td><button class="btn btn-light" id="send36" onclick="sendNumber('36')">&nbsp;&nbsp;</button></td>
        </tr>
        <tr>
            <td><button class="btn btn-light" id="send40" onclick="sendNumber('40')">&nbsp;&nbsp;</button></td>
            <td><button class="btn btn-light" id="send41" onclick="sendNumber('41')">&nbsp;&nbsp;</button></td>
            <td><button class="btn btn-light" id="send42" onclick="sendNumber('42')">&nbsp;&nbsp;</button></td>
            <td><button class="btn btn-light" id="send43" onclick="sendNumber('43')">&nbsp;&nbsp;</button></td>
            <td><button class="btn btn-light" id="send44" onclick="sendNumber('44')">&nbsp;&nbsp;</button></td>
            <td><button class="btn btn-light" id="send45" onclick="sendNumber('45')">&nbsp;&nbsp;</button></td>
            <td><button class="btn btn-light" id="send46" onclick="sendNumber('46')">&nbsp;&nbsp;</button></td>
        </tr>
        <tr>
            <td><button class="btn btn-light" id="send50" onclick="sendNumber('50')">&nbsp;&nbsp;</button></td>
            <td><button class="btn btn-light" id="send51" onclick="sendNumber('51')">&nbsp;&nbsp;</button></td>
            <td><button class="btn btn-light" id="send52" onclick="sendNumber('52')">&nbsp;&nbsp;</button></td>
            <td><button class="btn btn-light" id="send53" onclick="sendNumber('53')">&nbsp;&nbsp;</button></td>
            <td><button class="btn btn-light" id="send54" onclick="sendNumber('54')">&nbsp;&nbsp;</button></td>
            <td><button class="btn btn-light" id="send55" onclick="sendNumber('55')">&nbsp;&nbsp;</button></td>
            <td><button class="btn btn-light" id="send56" onclick="sendNumber('56')">&nbsp;&nbsp;</button></td>
        </tr>
        <tr>
            <td><button class="btn btn-light" id="send60" onclick="sendNumber('60')">&nbsp;&nbsp;</button></td>
            <td><button class="btn btn-light" id="send61" onclick="sendNumber('61')">&nbsp;&nbsp;</button></td>
            <td><button class="btn btn-light" id="send62" onclick="sendNumber('62')">&nbsp;&nbsp;</button></td>
            <td><button class="btn btn-light" id="send63" onclick="sendNumber('63')">&nbsp;&nbsp;</button></td>
            <td><button class="btn btn-light" id="send64" onclick="sendNumber('64')">&nbsp;&nbsp;</button></td>
            <td><button class="btn btn-light" id="send65" onclick="sendNumber('65')">&nbsp;&nbsp;</button></td>
            <td><button class="btn btn-light" id="send66" onclick="sendNumber('66')">&nbsp;&nbsp;</button></td>
        </tr>
    </table>
</div>

<br/><br/>

<table border="0" cellpadding="0" cellspacing="0" id="board2"  >
    <tr>
        <td><button type="button" class="btn btn-primary" onclick="choiceNumber(1)">1</button></td>
        <td><button type="button" class="btn btn-secondary" onclick="choiceNumber(2)">2</button></td>
        <td><button type="button" class="btn btn-success" onclick="choiceNumber(3)">3</button></td>
        <td><button type="button" class="btn btn-danger" onclick="choiceNumber(4)">4</button></td>
        <td><button type="button" class="btn btn-warning" onclick="choiceNumber(5)">5</button></td>
        <td><button type="button" class="btn btn-info" onclick="choiceNumber(6)">6</button></td>
        <td><button type="button" class="btn btn-dark" onclick="choiceNumber(7)">7</button></td>
    <tr align="center" >
        <td id="one">3</td>
        <td id="two">3</td>
        <td id="three">3</td>
        <td id="four">3</td>
        <td id="five">3</td>
        <td id="six">3</td>
        <td id="seven">2</td>
    </tr>
</table>


<div id="chatroom" style="width:400px; height: 600px; border:1px solid; background-color : gray"></div>
<input type="text" id="message" style="height : 30px; width : 340px" placeholder="내용을 입력하세요" autofocus>
<button class="btn btn-primary" id="send">전송</button>

<div id="chatGame" style="width:400px; border:1px solid; background-color : gray"></div>





</body>

<script th:inline="javascript">
    let webSocket;
    /* <![CDATA[*/
    let roomId = [[${room.roomId}]];
    /* ]]> */
    let userNm = document.getElementById('userName').innerHTML;
    connect();
    document.getElementById("send").addEventListener("click", function () {
        send();
    })


    var check = false;
    var numberChoice = 0;

    function sendNumber(number) {
        if (check === true) {
            webSocket.send(JSON.stringify({chatRoomId: roomId, type: 'GAME', writer: userNm, message: number+"##"+numberChoice}));
        } else {
            const chatroom = document.getElementById("chatroom");
            chatroom.innerHTML = chatroom.innerHTML + "<br>" + "숫자 버튼을 선택해주세요";

        }
    }

    function choiceNumber(number) {
        check = true;
        numberChoice = number;
    }


    function connect() {
        webSocket = new WebSocket("ws://localhost:8080/chat");
        webSocket.onopen = onOpen;
        webSocket.onclose = onClose;
        webSocket.onmessage = onMessage;
    }

    function disconnect() {
        webSocket.send(JSON.stringify({chatRoomId: roomId, type: 'LEAVE', writer: userNm}));
        webSocket.close();
    }

    function send() {
        const msg = document.getElementById("message").value;
        webSocket.send(JSON.stringify({chatRoomId: roomId, type: 'CHAT', writer: userNm, message: msg}));
        document.getElementById("message").value = "";
    }

    function onOpen() {
        webSocket.send(JSON.stringify({chatRoomId: roomId, type: 'ENTER', writer: userNm}));
    }

    function onMessage(e) {
        // const data = JSON.parse(e.data);
        console.log(e);
        const data = JSON.stringify(e.data);
        if (data.indexOf("GR^^")) {
            document.getElementById("roomUserCount").value = "";
        } else {
            const chatroom = document.getElementById("chatroom");
            chatroom.innerHTML = chatroom.innerHTML + "<br>" + data;
        }

        /**
         *
         *

         switch(msg.type) {
            case "id":
              clientID = msg.id;
              setUsername();
              break;
            case "username":
              text = "<b>User <em>" + msg.name + "</em> signed in at " + timeStr + "</b><br>";
              break;
            case "message":
              text = "(" + timeStr + ") <b>" + msg.name + "</b>: " + msg.text + "<br>";
              break;
            case "rejectusername":
              text = "<b>Your username has been set to <em>" + msg.name + "</em> because the name you chose is in use.</b><br>"
              break;
            case "userlist":
              var ul = "";
              for (i=0; i < msg.users.length; i++) {
                ul += msg.users[i] + "<br>";
          }
          document.getElementById("userlistbox").innerHTML = ul;
          break;
        }

         if (text.length) {
    f.write(text);
    document.getElementById("chatbox").contentWindow.scrollByPages(1);
  }


         *


         */
    }

    function onClose() {
        disconnect();
    }

</script>
</html>